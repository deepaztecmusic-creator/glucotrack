<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="GlucoTrack">
<title>GlucoTrack</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
<style>
/* --- ALL STYLES FROM YOUR PROVIDED CODE --- */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
:root{
  --bg:#F4F6F9;--white:#fff;--border:#E2E6ED;--border2:#C8CDD8;
  --text:#0D1321;--t2:#5A6478;--t3:#9AA3B5;
  --low:#E53E3E;--low-bg:#FFF5F5;--low-b:#FEB2B2;
  --ok:#38A169;--ok-bg:#F0FFF4;--ok-b:#9AE6B4;
  --hi:#D97706;--hi-bg:#FFFBEB;--hi-b:#FCD34D;
  --vhi:#E53E3E;--acc:#1A56DB;--acc-bg:#EBF5FF;--acc-b:#93C5FD;
  --pur:#7C3AED;--pur-bg:#F5F3FF;
  --sh:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --sh2:0 4px 16px rgba(0,0,0,.09);
  --r:14px;--rs:8px;
}
body.dark{
  --bg:#0D1321;--white:#1a2236;--border:#243049;--border2:#2d3d57;
  --text:#e8edf5;--t2:#8899bb;--t3:#4a5a7a;
  --low-bg:#2d1515;--low-b:#7f2020;
  --ok-bg:#0d2a1a;--ok-b:#1a5c30;
  --hi-bg:#2a1f08;--hi-b:#7a4f0a;
  --acc-bg:#0d1e3d;--acc-b:#1a3a6b;
  --pur-bg:#1a0d35;
}
html, body { height: 100%; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
.app-container { max-width: 430px; margin: 0 auto; height: 100%; display: flex; flex-direction: column; background: var(--bg); position: relative; }

/* UI Components */
.topbar { background: var(--white); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); z-index: 10; }
.logo { font-weight: 800; color: var(--acc); }
.logo span { color: var(--text); }
.scroll { flex: 1; overflow-y: auto; padding-bottom: 100px; }
.card { margin: 12px; background: var(--white); border-radius: var(--r); padding: 16px; box-shadow: var(--sh); border: 1px solid var(--border); }

/* Glucose Hero */
.gc-num { font-size: 54px; font-weight: 800; font-family: 'JetBrains Mono'; color: var(--ok); }
.gc-unit { font-size: 14px; color: var(--t3); font-family: 'JetBrains Mono'; }

/* Chart Styling */
.chart-wrap { height: 200px; width: 100%; position: relative; margin-top: 10px; }
canvas { width: 100% !important; height: 100% !important; }

/* FAB */
.fab { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--acc); color: white; padding: 14px 28px; border-radius: 50px; font-weight: 700; border: none; box-shadow: var(--sh2); cursor: pointer; z-index: 100; }

/* Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: flex-end; z-index: 1000; }
.modal-overlay.open { display: flex; }
.modal { width: 100%; background: var(--white); border-radius: 20px 20px 0 0; padding: 20px; transform: translateY(100%); transition: transform 0.3s ease; }
.modal-overlay.open .modal { transform: translateY(0); }
.input-group { margin-bottom: 15px; }
.input-group label { display: block; font-size: 11px; font-weight: 700; color: var(--t3); text-transform: uppercase; margin-bottom: 5px; }
input { width: 100%; padding: 12px; border-radius: var(--rs); border: 1px solid var(--border); font-size: 16px; background: var(--bg); color: var(--text); }
.save-btn { width: 100%; padding: 15px; background: var(--acc); color: white; border: none; border-radius: var(--rs); font-weight: 700; margin-top: 10px; }

/* History List */
.entry { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
.entry:last-child { border-bottom: none; }
</style>
</head>
<body>

<div class="app-container">
    <div class="topbar">
        <div class="logo">GLUCO<span>TRACK</span></div>
        <div id="themeToggle" style="cursor:pointer">üåô</div>
    </div>

    <div class="scroll">
        <div class="card">
            <div style="font-size: 11px; font-weight: 700; color: var(--t3); letter-spacing: 1px;">LATEST READING</div>
            <div style="display: flex; align-items: baseline; gap: 8px;">
                <div id="currentValue" class="gc-num">--.-</div>
                <div class="gc-unit">mmol/L</div>
            </div>
            <div id="statusBadge" style="font-size: 12px; font-weight: 600; margin-top: -5px;">No data yet</div>
        </div>

        <div class="card">
            <div style="font-size: 11px; font-weight: 700; color: var(--t3); margin-bottom: 10px;">24-HOUR TREND</div>
            <div class="chart-wrap">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div style="font-size: 11px; font-weight: 700; color: var(--t3); margin-bottom: 10px;">RECENT LOGS</div>
            <div id="historyList">
                <div style="color: var(--t3); font-size: 13px; text-align: center; padding: 20px;">No entries yet.</div>
            </div>
        </div>
    </div>

    <button class="fab" onclick="toggleModal(true)">+ ADD READING</button>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="font-size: 18px; font-weight: 800;">Log Glucose</h2>
            <button onclick="toggleModal(false)" style="background:none; border:none; font-size: 20px; color: var(--t3);">&times;</button>
        </div>
        
        <div class="input-group">
            <label>Glucose Level (mmol/L)</label>
            <input type="number" id="glucoseInput" step="0.1" placeholder="e.g. 5.5" inputmode="decimal">
        </div>

        <div class="input-group">
            <label>Notes (Optional)</label>
            <input type="text" id="noteInput" placeholder="After lunch, etc.">
        </div>

        <button class="save-btn" onclick="saveEntry()">SAVE READING</button>
    </div>
</div>

<script>
// --- STATE MANAGEMENT ---
let readings = JSON.parse(localStorage.getItem('glucoData')) || [];

// --- THEME ---
const themeToggle = document.getElementById('themeToggle');
themeToggle.onclick = () => {
    document.body.classList.toggle('dark');
    const isDark = document.body.classList.contains('dark');
    themeToggle.innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
    renderChart();
};

// --- CORE FUNCTIONS ---
function toggleModal(show) {
    const overlay = document.getElementById('modalOverlay');
    overlay.classList.toggle('open', show);
    if(show) document.getElementById('glucoseInput').focus();
}

function saveEntry() {
    const val = parseFloat(document.getElementById('glucoseInput').value);
    const note = document.getElementById('noteInput').value;
    
    if(!val) return alert("Please enter a value");

    const newEntry = {
        id: Date.now(),
        value: val,
        note: note,
        time: new Date().toISOString()
    };

    readings.unshift(newEntry);
    localStorage.setItem('glucoData', JSON.stringify(readings));
    
    // Reset and close
    document.getElementById('glucoseInput').value = '';
    document.getElementById('noteInput').value = '';
    toggleModal(false);
    
    updateUI();
}

function updateUI() {
    const historyList = document.getElementById('historyList');
    const currentValDisplay = document.getElementById('currentValue');
    const statusBadge = document.getElementById('statusBadge');

    if (readings.length === 0) return;

    // Update Hero
    const latest = readings[0];
    currentValDisplay.innerText = latest.value.toFixed(1);
    
    if(latest.value < 3.9) {
        statusBadge.innerText = "LOW"; statusBadge.style.color = "var(--low)";
    } else if(latest.value > 10.0) {
        statusBadge.innerText = "HIGH"; statusBadge.style.color = "var(--hi)";
    } else {
        statusBadge.innerText = "IN RANGE"; statusBadge.style.color = "var(--ok)";
    }

    // Update History
    historyList.innerHTML = readings.slice(0, 5).map(r => `
        <div class="entry">
            <div>
                <div style="font-weight:700">${r.value.toFixed(1)} <span style="font-size:10px; color:var(--t3)">mmol/L</span></div>
                <div style="font-size:11px; color:var(--t3)">${new Date(r.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
            </div>
            <div style="font-size:12px; color:var(--t2)">${r.note || ''}</div>
        </div>
    `).join('');

    renderChart();
}

// --- CHARTING ENGINE (Abbott-style) ---
function renderChart() {
    const canvas = document.getElementById('mainChart');
    const ctx = canvas.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    
    // Size canvas
    const rect = canvas.parentElement.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    if (readings.length < 2) return;

    const width = rect.width;
    const height = rect.height;
    const padding = 20;

    // Get range
    const sortedReadings = [...readings].sort((a,b) => new Date(a.time) - new Date(b.time));
    const data = sortedReadings.slice(-10); // Last 10 points
    
    const minVal = 2;
    const maxVal = 15;
    
    const getX = (i) => padding + (i * (width - padding * 2) / (data.length - 1));
    const getY = (val) => height - padding - ((val - minVal) * (height - padding * 2) / (maxVal - minVal));

    // Draw Target Zones (Green band)
    ctx.fillStyle = document.body.classList.contains('dark') ? 'rgba(56, 161, 105, 0.1)' : 'rgba(56, 161, 105, 0.05)';
    const topY = getY(10);
    const bottomY = getY(3.9);
    ctx.fillRect(0, topY, width, bottomY - topY);

    // Draw Line
    ctx.beginPath();
    ctx.strokeStyle = '#1A56DB';
    ctx.lineWidth = 3;
    ctx.lineJoin = 'round';

    data.forEach((point, i) => {
        const x = getX(i);
        const y = getY(point.value);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();

    // Draw Points
    data.forEach((point, i) => {
        ctx.beginPath();
        ctx.fillStyle = '#1A56DB';
        ctx.arc(getX(i), getY(point.value), 4, 0, Math.PI * 2);
        ctx.fill();
    });
}

// Init
window.addEventListener('resize', renderChart);
updateUI();
</script>

</body>
</html>
