<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="GlucoTrack">
<meta name="theme-color" content="#0D1321">
<title>GlucoTrack</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* CSS styles remain identical to your original provided styles */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
:root{
  --bg:#F4F6F9;--white:#fff;--border:#E2E6ED;--border2:#C8CDD8;
  --text:#0D1321;--t2:#5A6478;--t3:#9AA3B5;
  --low:#E53E3E;--low-bg:#FFF5F5;--low-b:#FEB2B2;
  --ok:#38A169;--ok-bg:#F0FFF4;--ok-b:#9AE6B4;
  --hi:#D97706;--hi-bg:#FFFBEB;--hi-b:#FCD34D;
  --vhi:#E53E3E;--acc:#1A56DB;--acc-bg:#EBF5FF;--acc-b:#93C5FD;
  --pur:#7C3AED;--pur-bg:#F5F3FF;
  --sh:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --sh2:0 4px 16px rgba(0,0,0,.09);
  --r:14px;--rs:8px;
}
body.dark{
  --bg:#0D1321;--white:#1a2236;--border:#243049;--border2:#2d3d57;
  --text:#e8edf5;--t2:#8899bb;--t3:#4a5a7a;
  --low-bg:#2d1515;--low-b:#7f2020;
  --ok-bg:#0d2a1a;--ok-b:#1a5c30;
  --hi-bg:#2a1f08;--hi-b:#7a4f0a;
  --acc-bg:#0d1e3d;--acc-b:#1a3a6b;
  --pur-bg:#1a0d35;
}
html{height:100%;background:var(--bg);}
body{height:100%;overflow:hidden;font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);max-width:430px;margin:0 auto;display:flex;flex-direction:column;}
.topbar{background:var(--white);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);z-index:210;}
.logo{font-size:16px;font-weight:800;color:var(--acc);letter-spacing:-.3px;}.logo span{color:var(--text);}
.wbar{background:#0D1321;padding:10px 16px;position:relative;overflow:hidden;color:#fff;}
.wbar-inner{display:flex;align-items:center;gap:10px;position:relative;z-index:1;}
.wnum{font-size:26px;font-weight:700;color:#34d399;font-family:'JetBrains Mono',monospace;}
.wnum.low{color:#f87171;}.wnum.hi{color:#fbbf24;}.wnum.none{color:#475569;}
.scroll{flex:1;overflow-y:auto;}
.card{margin:12px 14px 0;background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:16px;box-shadow:var(--sh);}
.gc-num{font-size:60px;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--ok);}
.rtrack{height:4px;border-radius:2px;background:linear-gradient(90deg,#E53E3E 0%,#38A169 30%,#38A169 70%,#D97706 85%,#E53E3E 100%);position:relative;margin-top:10px;}
.rneedle{position:absolute;top:-5px;width:2px;height:14px;background:var(--text);border-radius:2px;left:50%;transition:left .5s ease;}
.fab{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:100;background:var(--acc);color:#fff;border:none;border-radius:50px;padding:13px 24px;font-weight:700;cursor:pointer;box-shadow:var(--sh2);}
.mbd{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:400;display:none;align-items:flex-end;justify-content:center;}
.mbd.open{display:flex;}
.msheet{width:100%;max-width:430px;background:#fff;border-radius:20px 20px 0 0;padding:20px 20px 40px;}
.bi{font-size:60px;font-weight:800;width:100%;text-align:center;border:none;outline:none;font-family:'JetBrains Mono',monospace;}
.cc{padding:8px 12px;background:var(--bg);border-radius:8px;cursor:pointer;font-size:12px;display:inline-block;margin:4px;}
.cc.selected{background:var(--acc);color:#fff;}
.svbtn{width:100%;padding:14px;background:var(--acc);color:#fff;border:none;border-radius:10px;font-weight:700;margin-top:20px;}
canvas.main-chart{width:100%;height:180px;}
</style>
</head>
<body>

<div class="topbar">
    <div class="logo">GLUCO<span>TRACK</span></div>
    <div class="topbar-date" id="currentDate">--:--</div>
</div>

<div class="wbar">
    <div class="wbar-inner">
        <div class="wnum none">--.-</div>
        <div style="font-size:10px; opacity:0.6;">mmol/L</div>
    </div>
</div>

<div class="scroll">
    <div class="card">
        <div class="gc-lbl">Current Glucose</div>
        <div class="gc-num none">--.-</div>
        <div class="rtrack"><div class="rneedle"></div></div>
    </div>

    <div class="card">
        <div class="sc-hd"><div class="sc-title">24h Trend (Abbott Style)</div></div>
        <canvas class="main-chart"></canvas>
    </div>

    <div id="historyList"></div>
</div>

<button class="fab">Log Reading</button>

<div class="mbd" id="logModal">
    <div class="msheet">
        <div class="mtop"><span class="mtitle">New Reading</span><button class="mclose">âœ•</button></div>
        <input type="number" class="bi" placeholder="0.0" step="0.1">
        <div style="text-align:center; color:var(--t3); margin-bottom:20px;">mmol/L</div>
        
        <div class="msec-lbl">Context</div>
        <div class="ctx-grid">
            <div class="cc" onclick="selectContext(this)">Fasting</div>
            <div class="cc" onclick="selectContext(this)">Pre-Meal</div>
            <div class="cc" onclick="selectContext(this)">Post-Meal</div>
            <div class="cc" onclick="selectContext(this)">Bedtime</div>
        </div>

        <button class="svbtn" onclick="saveReading()">Save Data</button>
    </div>
</div>

<script>
/** * GLUCOTRACK SCRIPT 
 * Units: mmol/L
 */

let readings = JSON.parse(localStorage.getItem('gt_readings')) || [];
const TARGET_LOW = 3.9;
const TARGET_HIGH = 10.0;

function init() {
    updateUI();
    setupListeners();
    renderChart();
}

function setupListeners() {
    document.querySelector('.fab').onclick = () => document.getElementById('logModal').classList.add('open');
    document.querySelector('.mclose').onclick = () => document.getElementById('logModal').classList.remove('open');
}

function selectContext(el) {
    document.querySelectorAll('.cc').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
}

function saveReading() {
    const valInput = document.querySelector('.bi');
    const val = parseFloat(valInput.value);
    const context = document.querySelector('.cc.selected')?.innerText || 'General';

    if(!val || val <= 0) return alert("Enter valid value");

    const entry = {
        id: Date.now(),
        val: val,
        context: context,
        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
    };

    readings.unshift(entry);
    localStorage.setItem('gt_readings', JSON.stringify(readings));
    
    valInput.value = '';
    document.getElementById('logModal').classList.remove('open');
    updateUI();
    renderChart();
}

function updateUI() {
    const latest = readings[0];
    const wnum = document.querySelector('.wnum');
    const gnum = document.querySelector('.gc-num');
    const needle = document.querySelector('.rneedle');

    if(latest) {
        const v = latest.val.toFixed(1);
        wnum.innerText = v;
        gnum.innerText = v;
        
        // Color coding
        let color = 'var(--ok)';
        if(latest.val < TARGET_LOW) color = 'var(--low)';
        if(latest.val > TARGET_HIGH) color = 'var(--hi)';
        
        wnum.style.color = color;
        gnum.style.color = color;

        // Needle Position (2 to 18 mmol/L scale)
        let pos = ((latest.val - 2) / (18 - 2)) * 100;
        needle.style.left = `${Math.max(5, Math.min(95, pos))}%`;
    }

    // Render History
    const hist = document.getElementById('historyList');
    hist.innerHTML = readings.slice(0,5).map(r => `
        <div class="card" style="padding:10px; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <div style="font-weight:700;">${r.val} <small>mmol/L</small></div>
                <div style="font-size:11px; color:var(--t3);">${r.context}</div>
            </div>
            <div style="font-size:11px; color:var(--t3);">${r.time}</div>
        </div>
    `).join('');
}

function renderChart() {
    const canvas = document.querySelector('.main-chart');
    const ctx = canvas.getContext('2d');
    const w = canvas.offsetWidth;
    const h = canvas.offsetHeight;
    canvas.width = w; canvas.height = h;

    if(readings.length < 2) return;

    // Draw target range background
    const yHigh = h - (TARGET_HIGH / 15 * h);
    const yLow = h - (TARGET_LOW / 15 * h);
    ctx.fillStyle = 'rgba(56, 161, 105, 0.1)';
    ctx.fillRect(0, yHigh, w, yLow - yHigh);

    // Draw line
    ctx.beginPath();
    ctx.strokeStyle = '#1A56DB';
    ctx.lineWidth = 3;
    
    const slice = readings.slice(0, 10).reverse();
    slice.forEach((r, i) => {
        const x = (i / (slice.length - 1)) * w;
        const y = h - (r.val / 15 * h);
        if(i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();
}

init();
</script>
</body>
</html>
