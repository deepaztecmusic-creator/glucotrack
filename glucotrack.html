<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>GlucoTrack</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* Using your specific variables and styles */
:root {
  --bg:#F4F6F9; --white:#fff; --border:#E2E6ED; --text:#0D1321; --t3:#9AA3B5;
  --low:#E53E3E; --ok:#38A169; --hi:#D97706; --acc:#1A56DB; --r:14px;
}
body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
.topbar { background: var(--white); padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
.logo { font-weight: 800; color: var(--acc); } .logo span { color: var(--text); }
.wbar { background: #0D1321; padding: 15px; color: #fff; display: flex; align-items: baseline; gap: 8px; }
.wnum { font-size: 28px; font-weight: 700; font-family: 'JetBrains Mono'; color: #34d399; }
.scroll { flex: 1; overflow-y: auto; padding-bottom: 80px; }
.card { margin: 12px; background: #fff; border: 1px solid var(--border); border-radius: var(--r); padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.gc-num { font-size: 50px; font-weight: 800; font-family: 'JetBrains Mono'; text-align: center; display: block; }
.rtrack { height: 6px; background: linear-gradient(90deg, #E53E3E, #38A169, #D97706, #E53E3E); border-radius: 3px; position: relative; margin: 15px 0; }
.rneedle { position: absolute; top: -4px; width: 4px; height: 14px; background: #000; border-radius: 2px; transition: 0.5s; }
.fab { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--acc); color: #fff; border: none; padding: 14px 28px; border-radius: 50px; font-weight: 700; box-shadow: 0 4px 12px rgba(26,86,219,0.3); cursor: pointer; }
.mbd { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: flex-end; z-index: 1000; }
.mbd.open { display: flex; }
.msheet { background: #fff; width: 100%; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; }
.bi { width: 100%; font-size: 45px; text-align: center; border: none; outline: none; font-family: 'JetBrains Mono'; }
.cc-grid { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
.cc { padding: 8px 15px; background: #eee; border-radius: 8px; cursor: pointer; font-size: 13px; }
.cc.selected { background: var(--acc); color: #fff; }
.svbtn { width: 100%; padding: 15px; background: var(--acc); color: #fff; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; margin-top: 10px; }
canvas { width: 100%; height: 150px; margin-top: 10px; }
</style>
</head>
<body>

<div class="topbar"><div class="logo">GLUCO<span>TRACK</span></div></div>
<div class="wbar">
    <div class="wnum" id="widgetNum">--.-</div>
    <div style="font-size: 12px; opacity: 0.6;">mmol/L</div>
</div>

<div class="scroll">
    <div class="card">
        <span style="font-size: 12px; font-weight: 700; color: var(--t3);">LATEST READING</span>
        <div class="gc-num" id="mainNum">--.-</div>
        <div class="rtrack"><div class="rneedle" id="needle"></div></div>
    </div>
    
    <div class="card">
        <span style="font-size: 12px; font-weight: 700; color: var(--t3);">24H TREND (mmol/L)</span>
        <canvas id="glucoseChart"></canvas>
    </div>

    <div id="history"></div>
</div>

<button class="fab" onclick="toggleModal(true)">+ Log Glucose</button>

<div class="mbd" id="logModal">
    <div class="msheet">
        <div style="display:flex; justify-content:space-between; margin-bottom: 20px;">
            <b style="font-size: 18px;">New Entry</b>
            <button onclick="toggleModal(false)" style="border:none; background:none; font-size: 20px;">âœ•</button>
        </div>
        <input type="number" class="bi" id="glucoseInput" placeholder="0.0" step="0.1">
        <p style="text-align:center; color:var(--t3); margin-top: -10px;">mmol/L</p>
        
        <div class="cc-grid">
            <div class="cc" onclick="selCtx(this)">Fasting</div>
            <div class="cc" onclick="selCtx(this)">Pre-Meal</div>
            <div class="cc" onclick="selCtx(this)">Post-Meal</div>
            <div class="cc selected" onclick="selCtx(this)">General</div>
        </div>
        <button class="svbtn" onclick="addEntry()">Save Reading</button>
    </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('gt_readings')) || [];

function toggleModal(show) {
    document.getElementById('logModal').classList.toggle('open', show);
    if(show) document.getElementById('glucoseInput').focus();
}

function selCtx(el) {
    document.querySelectorAll('.cc').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
}

function addEntry() {
    const val = parseFloat(document.getElementById('glucoseInput').value);
    const ctx = document.querySelector('.cc.selected').innerText;
    
    if(!val || val <= 0) return alert("Please enter a valid mmol/L value");

    const entry = {
        val: val,
        ctx: ctx,
        ts: Date.now(),
        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
    };

    data.unshift(entry);
    localStorage.setItem('gt_readings', JSON.stringify(data));
    
    document.getElementById('glucoseInput').value = '';
    toggleModal(false);
    refresh();
}

function refresh() {
    const latest = data[0];
    const wNum = document.getElementById('widgetNum');
    const mNum = document.getElementById('mainNum');
    const needle = document.getElementById('needle');

    if(latest) {
        const v = latest.val.toFixed(1);
        wNum.innerText = v;
        mNum.innerText = v;

        // Color logic for mmol/L
        let color = '#38A169'; // OK
        if(latest.val < 3.9) color = '#E53E3E'; // Low
        if(latest.val > 10.0) color = '#D97706'; // High
        
        wNum.style.color = color;
        mNum.style.color = color;

        // Needle move (Range 2.0 to 18.0)
        let percent = ((latest.val - 2) / (18 - 2)) * 100;
        needle.style.left = Math.max(0, Math.min(98, percent)) + '%';
    }

    // History List
    const histDiv = document.getElementById('history');
    histDiv.innerHTML = data.slice(0, 10).map(item => `
        <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding: 12px 16px;">
            <div>
                <b style="font-size: 16px;">${item.val.toFixed(1)}</b> <small>mmol/L</small>
                <div style="font-size: 11px; color: var(--t3);">${item.ctx}</div>
            </div>
            <div style="font-size: 11px; color: var(--t3);">${item.time}</div>
        </div>
    `).join('');

    drawChart();
}

function drawChart() {
    const canvas = document.getElementById('glucoseChart');
    const ctx = canvas.getContext('2d');
    const w = canvas.offsetWidth;
    const h = canvas.offsetHeight;
    canvas.width = w; canvas.height = h;

    if(data.length < 2) return;

    // Draw Target Zone (3.9 - 10.0 mmol/L)
    ctx.fillStyle = 'rgba(56, 161, 105, 0.1)';
    const yHigh = h - (10 / 18 * h);
    const yLow = h - (3.9 / 18 * h);
    ctx.fillRect(0, yHigh, w, yLow - yHigh);

    // Draw Data Line
    ctx.beginPath();
    ctx.strokeStyle = '#1A56DB';
    ctx.lineWidth = 3;
    ctx.lineJoin = 'round';

    const points = data.slice(0, 10).reverse();
    points.forEach((p, i) => {
        const x = (i / (points.length - 1)) * w;
        const y = h - (p.val / 18 * h);
        if(i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();
}

// Start
refresh();
window.addEventListener('resize', drawChart);
</script>

</body>
</html>
