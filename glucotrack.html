<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GlucoTrack">
    <title>GlucoTrack AI</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        :root{
            --bg:#F4F6F9;--white:#fff;--border:#E2E6ED;--border2:#C8CDD8;
            --text:#0D1321;--t2:#5A6478;--t3:#9AA3B5;
            --low:#E53E3E;--low-bg:#FFF5F5;--low-b:#FEB2B2;
            --ok:#38A169;--ok-bg:#F0FFF4;--ok-b:#9AE6B4;
            --hi:#D97706;--hi-bg:#FFFBEB;--hi-b:#FCD34D;
            --acc:#1A56DB;--acc-bg:#EBF5FF;--acc-b:#93C5FD;
            --sh:0 1px 3px rgba(0,0,0,.06);--sh2:0 4px 16px rgba(0,0,0,.09);
            --r:14px;--rs:8px;
        }
        body.dark{
            --bg:#0D1321;--white:#1a2236;--border:#243049;--border2:#2d3d57;
            --text:#e8edf5;--t2:#8899bb;--t3:#4a5a7a;
            --low-bg:#2d1515;--ok-bg:#0d2a1a;--acc-bg:#0d1e3d;
        }
        
        html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; max-width: 430px; margin: 0 auto; display: flex; flex-direction: column; }
        
        /* Layout Components */
        .topbar { background: var(--white); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); z-index: 10; }
        .logo { font-size: 16px; font-weight: 800; color: var(--acc); letter-spacing: -.3px; }
        .logo span { color: var(--text); }
        
        .wbar { background: #0D1321; padding: 10px 16px; position: relative; color: white; }
        .wbar-inner { display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 1; }
        .wnum { font-size: 26px; font-weight: 700; color: #34d399; font-family: 'JetBrains Mono'; }
        
        .scroll { flex: 1; overflow-y: auto; padding-bottom: 100px; }
        .card { margin: 12px 14px 0; background: var(--white); border: 1px solid var(--border); border-radius: var(--r); padding: 16px; box-shadow: var(--sh); }
        
        /* Glucose Hero */
        .gc-row { display: flex; align-items: baseline; gap: 8px; margin: 8px 0; }
        .gc-num { font-size: 54px; font-weight: 800; color: var(--ok); font-family: 'JetBrains Mono'; letter-spacing: -2px; }
        .gc-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 700; text-transform: uppercase; border: 1px solid; }
        
        /* Range Strip */
        .rtrack { height: 6px; border-radius: 3px; background: linear-gradient(90deg, #E53E3E 0%, #38A169 40%, #38A169 60%, #D97706 100%); position: relative; margin: 15px 0; }
        .rneedle { position: absolute; top: -4px; width: 4px; height: 14px; background: var(--text); border-radius: 2px; transition: 0.5s ease; }

        /* Stats Grid */
        .strow { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 12px 14px; }
        .st { background: var(--white); border: 1px solid var(--border); border-radius: var(--rs); padding: 12px; text-align: center; }
        .stv { font-size: 18px; font-weight: 800; font-family: 'JetBrains Mono'; }
        .stl { font-size: 10px; color: var(--t3); text-transform: uppercase; margin-top: 4px; }

        /* Chart */
        .chart-wrap { height: 180px; width: 100%; margin-top: 10px; }

        /* FAB */
        .fab { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--acc); color: white; border: none; padding: 14px 28px; border-radius: 50px; font-weight: 700; box-shadow: 0 8px 20px rgba(26,86,219,0.3); z-index: 100; cursor: pointer; }

        /* Modal */
        .mbd { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: flex-end; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1000; }
        .mbd.open { opacity: 1; pointer-events: all; }
        .msheet { width: 100%; background: var(--white); border-radius: 20px 20px 0 0; padding: 20px; transform: translateY(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .mbd.open .msheet { transform: translateY(0); }
        
        .bi { width: 100%; font-size: 48px; font-weight: 800; text-align: center; border: none; outline: none; background: transparent; color: var(--text); font-family: 'JetBrains Mono'; }
        .svbtn { width: 100%; background: var(--acc); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 700; margin-top: 20px; cursor: pointer; }
        
        .cc { padding: 10px; border: 1px solid var(--border); border-radius: 8px; text-align: center; font-size: 12px; cursor: pointer; font-weight: 600; }
        .cc.selected { background: var(--acc-bg); border-color: var(--acc); color: var(--acc); }
        .ctxg { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
    </style>
</head>
<body class="dark">

    <div class="topbar">
        <div class="logo">GLUCO<span>TRACK</span></div>
        <div id="date-label" style="font-size: 11px; font-family: 'JetBrains Mono'; color: var(--t3);">FEB 28, 2026</div>
    </div>

    <div class="wbar">
        <div class="wbar-inner">
            <div>
                <span style="font-size: 10px; color: #64748b; text-transform: uppercase;">Latest</span>
                <div class="wnum" id="w-val">--</div>
            </div>
            <button onclick="openModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 600;">ðŸ“¸ Meal AI</button>
        </div>
    </div>

    <main class="scroll">
        <div class="card">
            <div class="gc-badge ok" id="status-badge" style="background: var(--ok-bg); color: var(--ok); border-color: var(--ok-b);">
                <span style="width:6px; height:6px; background:currentColor; border-radius:50%;"></span> In Range
            </div>
            <div class="gc-row">
                <span class="gc-num" id="h-val">--</span>
                <span style="font-size: 14px; color: var(--t3); font-family: 'JetBrains Mono';">mg/dL</span>
            </div>
            <div class="rtrack"><div class="rneedle" id="needle" style="left: 50%"></div></div>
        </div>

        <div class="card">
            <div style="font-size: 13px; font-weight: 700; margin-bottom: 10px;">Glucose Trend</div>
            <div class="chart-wrap">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="strow">
            <div class="st"><div class="stv" id="s-avg">--</div><div class="stl">Avg</div></div>
            <div class="st"><div class="stv" id="s-tir">--%</div><div class="stl">TIR</div></div>
            <div class="st"><div class="stv" id="s-a1c">--</div><div class="stl">Est. A1c</div></div>
        </div>
    </main>

    <button class="fab" onclick="openModal()">+ Log Glucose</button>

    <div class="mbd" id="modal">
        <div class="msheet">
            <div style="width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 20px;"></div>
            <input type="number" id="bg-input" class="bi" placeholder="100" autofocus>
            <div style="text-align: center; font-size: 12px; color: var(--t3); font-family: 'JetBrains Mono';">mg/dL</div>
            
            <div class="ctxg">
                <div class="cc selected" onclick="selectCtx(this)">Fasting</div>
                <div class="cc" onclick="selectCtx(this)">Pre-Meal</div>
                <div class="cc" onclick="selectCtx(this)">Post-Meal</div>
                <div class="cc" onclick="selectCtx(this)">Bedtime</div>
            </div>
            
            <button class="svbtn" onclick="addEntry()">Confirm Reading</button>
            <button onclick="closeModal()" style="width: 100%; background: none; border: none; padding: 12px; color: var(--t3); font-size: 13px;">Cancel</button>
        </div>
    </div>

    

    <script>
        let logs = JSON.parse(localStorage.getItem('gluclogs')) || [
            {val: 95, time: Date.now() - 3600000 * 3},
            {val: 120, time: Date.now() - 3600000 * 2},
            {val: 112, time: Date.now() - 3600000 * 1}
        ];
        let chart;

        function init() {
            renderUI();
            const ctx = document.getElementById('mainChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: logs.slice(-10).map(l => new Date(l.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})),
                    datasets: [{
                        data: logs.slice(-10).map(l => l.val),
                        borderColor: '#38A169',
                        backgroundColor: 'rgba(56, 161, 105, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: false, min: 40, max: 250 },
                        x: { grid: { display: false }, ticks: { color: '#9AA3B5', font: { size: 10 } } }
                    }
                }
            });
        }

        function openModal() { document.getElementById('modal').classList.add('open'); document.getElementById('bg-input').focus(); }
        function closeModal() { document.getElementById('modal').classList.remove('open'); }

        function selectCtx(el) {
            document.querySelectorAll('.cc').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }

        function addEntry() {
            const val = parseInt(document.getElementById('bg-input').value);
            if(!val) return;
            
            logs.push({val: val, time: Date.now()});
            localStorage.setItem('gluclogs', JSON.stringify(logs));
            
            closeModal();
            renderUI();
            updateChart();
            document.getElementById('bg-input').value = '';
        }

        function renderUI() {
            const last = logs[logs.length - 1].val;
            document.getElementById('h-val').innerText = last;
            document.getElementById('w-val').innerText = last;
            
            // Stats
            const avg = Math.round(logs.reduce((a,b) => a + b.val, 0) / logs.length);
            document.getElementById('s-avg').innerText = avg;
            document.getElementById('s-a1c').innerText = (3.31 + (0.02392 * avg)).toFixed(1);
            
            const tir = Math.round((logs.filter(l => l.val >= 70 && l.val <= 180).length / logs.length) * 100);
            document.getElementById('s-tir').innerText = tir + "%";

            // Needle
            const pct = Math.min(Math.max(((last - 40) / 200) * 100, 0), 100);
            document.getElementById('needle').style.left = pct + "%";

            // Color logic
            const color = last < 70 ? '#E53E3E' : (last > 180 ? '#D97706' : '#38A169');
            document.getElementById('h-val').style.color = color;
        }

        function updateChart() {
            chart.data.labels = logs.slice(-10).map(l => new Date(l.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}));
            chart.data.datasets[0].data = logs.slice(-10).map(l => l.val);
            chart.update();
        }

        init();
    </script>
</body>
</html>
